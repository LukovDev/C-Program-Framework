# C Program Framework
### Незамышлённый фреймворк для разработки своих проектов на языке программирования <Си> (англ. C)
### Описание:
#### Представляет собой гибкую и простую структуру файлов и папок. А так же, этот фреймворк имеет свою систему сборки проекта (на данный момент система сборки простая, и не подходит для сложных проектов!!!).</br>
#### Подходит для минимального старта разработки проектов на Си, без сложных других систем сборок (включая **CMake**, **Make**, **Ninja** и пр., но при желании можно вручную модифицировать). Для работы вам понадобится всего лишь компилятор си (gcc/clang) и python (от 3.x до 3.11.8 проверенно!). Систему сборки можно удалить, модифицировать под себя, или вообще заменить на другую по желанию.

#

### Краткая инструкция по использованию:

##### **<| В ЭТОЙ ИНСТРУКЦИИ НЕ БУДЕТ ПРИМЕРОВ НАГЛЯДНО. ВЫ ДОЛЖНЫ САМИ ПОНИМАТЬ ЧТО ДЕЛАЕТЕ, ЗАЧЕМ И ПОЧЕМУ |>**

#### Хорошо, а как скачать этот ваш фреймворк?

Для скачивания фреймворка используйте прямую ссылку на скачивание [этого репозитория](https://github.com/LukovDev/C-Program-Framework/archive/refs/heads/master.zip)</br>
Если вы достаточно опытны, вы можете сами модифицировать фреймворк. Например: удалять прочие файлы, по типу ```README.md```, ```LICENSE.txt``` и пр., или модифицировать систему сборки.

На данный момент, официально фреймворк работает на:</br>
- **Windows** [✓]
- **MacOS** [✓]
- **Linux** [⚠] (Не протестировано!).

#### Окей, вот я скачал, и что дальше?

А дальше, разархивируйте архив и переместите из полученной папки содержимое (все файлы и папки) в другую папку, или переименуйте её так как вам удобнее. Обычно, это название вашего проекта.

#### А потом что?

Теперь, откройте эту папку как папку проекта в редакторе кода.
Все исходные скрипты и коды должны находиться в папке ```src```!

#

### Теперь поясню за структуру фреймворка и её работу (Это Важно!)

#### 1. Файлы и папки
Перед вами будет примерно такое содержимое:</br>
- MyProject/</br>
  | File/Folder | Description |
  | --- | --- |
  | .vscode/ | Хранит конфигурацию для запуска сборки и запуска бинарника. Требуется python. Если вы не используете редактор **VSCode** то можете удалить. |
  | build/ | Папка в которой находится конфигурация сборки и вывод сборки. |
  | data/ | Папка в которой должны находиться ваши данные. Вы можете её переименовать или вообще изменить (не забудьте указать изменения в конфиге сборки!). |
  | src/ | Это главная папка проекта. В ней хранятся все скрипты и коды. |
  | build.bat | Точка для запуска сборки проекта. Запускается в системе **Windows**. |
  | build.sh | Точка для запуска сборки проекта. Запускается в системе **MacOS** и **Linux**. |
  | run.bat | Точка для запуска скомпилированного проекта. Запускается в системе **Windows**. |
  | run.sh | Точка для запуска скомпилированного проекта. Запускается в системе **MacOS** и **Linux**. |
  | ... | _Вероятно могут быть и другие файлы, но основные из них выше_ |

#### 2. Папка сборки
Если с папками ```src/```, ```data/```, файлами сборки и запуска всё понятно, то что за папка **build/**?

Содержимое папки сборки может быть такой:</br>
- build/</br>
  | File/Folder | Description |
  | --- | --- |
  | bin/ | Появится после запуска первой сборки. В ней хранятся все готовые бинарные файлы после сборки и динамические библиотеки для запуска программы. |
  | obj/ | Появится после запуска первой сборки. В ней хранятся объектные файлы исходников и прочее необходимое для компиляции. Она не удаляется для ускорения сборки. |
  | tools/ | Это важная папка системы сборки. В ней хранятся скрипты для сборки и запуска, и кэш сборки для её ускорения. |
  | config.json | Это конфигурационный файл системы сборки. В нём вы можете всё настроить под себя. |

#### 3. Конфигурация сборки
Она может выглядеть примерно так:
```json
{
    "program-name": "C Program Framework",
    "program-icon": "data/icons/icon.ico",
    "compiler":     "gcc",
    "std":          "c99",
    "strip":        true,
    "includes":     ["src/include/"],
    "libraries":    [],
    "libnames":     [],
    "optimization": "-O2",
    "console-disabled": false,
    "warnings": ["-Wall"],
    "compile-flags": [],
    "linker-flags": []
}
```

! Вы должны разбираться в том как компилировать программы на C/C++ чтобы что-нибудь тут изменить !

Но кроме того, можно изменить вот что:
| Key | Description |
| --- | --- |
| "program-name" | В кавычках указывается название бинарного файла. |
| "program-icon" | В кавычках указывается путь до иконки. |
| "compiler" | В кавычках укажите ваш компилятор, или путь до него. |
| "strip" | ```true```/```false``` если хотите убрать отладочную информацию и уменьшить размер бинарника. |
| "includes" | В кавычках через запятую укажите пути до папок в которых лежат ваши заголовочные файлы. |
| "libraries" | В кавычках через запятую укажите пути до папок с библиотеками. Это автоматизация флагов ```-L``` |
| "libnames" | В кавычках через запятую укажите названия библиотек. Это автоматизация флагов ```-l``` |
| "console-disabled" | ```true```/```false``` если хотите отключить отображение консоли. |
| "compile-flags" | Список дополнительных флагов компиляции которые надо указывать в кавычках через запятую. |
| "linker-flags" | Список дополнительных флагов линковки которые надо указывать в кавычках через запятую. |

**Особенности конфигурационного файла:**</br>
Такие параметры как: ```"program-icon"```, ```"console-disabled"```, работают только в системе **Windows**!

#

### Принцип работы системы сборки
![](https://github.com/user-attachments/assets/274f7738-df8f-4cd8-9560-26d2a9d3fbe9)

Система сборки написана на питоне. При её запуске, происходит следующее:
1. Чтение файлов ```build/tools/metadata.json``` и ```build/config.json```
2. Поиск всех си файлов в ```src/```
3. Проверка файлов. Включает в себя:
    - Получение нового ```build/tools/metadata.json```. Метаданные хранят список файлов исходников и время их изменения в секундах.
    - Получение разницы из новых метаданных по сравнению со старым. А именно: Изменённые файлы, добавленные файлы, удаленные файлы.
    - Если папки ```obj``` для хранения файлов для линков нет в ```build/``` то она создаётся.
    - Если папка ```build/bin/``` есть, то удаляем. Потом просто создаём эту папку даже если её не было.
    - Удаляются объектные файлы удаленных исходников из ```build/obj/``` в случае если они там есть.
    - Удаляются лишние объектные файлы, которых не должно быть (например: старые объектные файлы которые больше не нужны или другие лишние объекты).
    - Проводится проверка на отсутствующие объектные файлы, чтобы добавить их исходник в список для компиляции.
    - Возвращается список путей исходников для компиляции.
4. Подготавливаются флаги для компиляции и линковки. Превращаем их в почти готовые команды.
5. Старт компиляции:
    - Из папки ```build/obj/``` удаляются все файлы с расширением ```.ico```
    - Создаём ```.o``` файл иконки если это Windows система используя ```icon.rc```, файл иконки ```.ico``` и ```windres```
    - Иначе если это не ```Windows``` система, ИЛИ если путь иконки указан как ```null``` то удаляем объект иконки и ```icon.rc``` при наличии.
    - Компилируем все необходимые исходники. Используем подготовленную команду компиляции. Компилируем исходник через ```-c``` в папку ```build/tmp/```
    - Линкуем все объектные файлы в один исполняемый файл. Используем подготовленную команду линковки. Линкуем в папку ```build/bin/```
6. Копируем все необходимые динамические библиотеки в папку ```build/bin/``` при наличии.

**Что делает:**</br>
Компилирует только изменённые, новые, и те исходники у которых нет объектного файла.</br>
Удаляет те объектные файлы, исходник которых удалён. Также удаляет лишние объекты, которых не должно быть (очистка от мусора). Она отслеживает файлы исходников и их время изменения.</br>
Ищет в указанных папках библиотек, определенные библиотеки чьи названия схожи с теми, что указаны в списке названий библиотек, и копирует их в папку ```build/bin/```.</br>

**Минусы:**</br>
- Компиляция последовательная, что медленнее чем параллельная.</br>
- Генерация флагов происходит в одну строку. Лучше сделать не строкой, а аргументами.</br>
- Нет кэширования компиляции.</br>

В будущем планируется добавить параллельную компиляцию для ускорения работы, а также по возможности кэширование компиляции. Тогда эта система сборки будет прям очень хорошей, и будет подходить для больших проектов.

#

### Для запуска файлов ```build.sh``` и ```run.sh``` на **MacOS**
Откройте терминал по адресу папки проекта, где находятся эти файлы, и выполните следующее:
```chmod +x build.sh run.sh```</br>
Это даст разрешение файлам выполняться.

#

### Связь со мной:
#### [Telegram](https://t.me/mr_lukov)
