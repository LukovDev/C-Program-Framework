# C Program Framework
### Незамышлённый фреймворк для разработки своих проектов на си
### Описание:
#### Представляет из себя гибкую и простую структуру файлов и папок. А так же, этот фреймворк имеет систему сборки проекта (на данный момент система сборки простая, и не подходит для сложных проектов!!!).

#


### Краткая инструкция по использованию:

##### **<| В ЭТОЙ ИНСТРУКЦИИ НЕ БУДЕТ ПРИМЕРОВ НАГЛЯДНО. ВЫ ДОЛЖНЫ САМИ ПОНИМАТЬ ЧТО ДЕЛАЕТЕ, ЗАЧЕМ И ПОЧЕМУ |>**

#### Хорошо, а как скачать этот ваш фреймворк?

Для скачивания фреймворка используйте прямую ссылку на скачивание [этого репозитория](https://github.com/LukovDev/C-Program-Framework/archive/refs/heads/master.zip)</br>
Если вы достаточно опытны, вы можете сами модифицировать фреймворк. Например: удалять прочие файлы, по типу ```README.md```, ```LICENSE.txt``` и пр., или модифицировать систему сборки.

На данный момент, официально фреймворк работает на:</br>
- **Windows** [✓]
- **MacOS** [✓]
- **Linux** [⚠] (Не протестированно!).

#### Окей, вот я скачал, и что дальше?

А дальше, разархивируйте архив и переместите из полученной папки содержимое (все файлы и папки) в другую папку, или переименуйте её так как вам удобнее. Обычно, это название вашего проекта.

#### А потом что?

Теперь, откройте эту папку как папку проекта в редакторе кода.
Все исходные скрипты и коды должны находиться в папке ```src```!

#

### Теперь поясню за структуру фреймворка и её работу (Это Важно!)

#### 1. Файлы и папки
Перед вами будет примерно такое содержимое:</br>
- MyProject/</br>
  | File/Folder | Description |
  | --- | --- |
  | .vscode/ | Хранит конфигурацию для запуска сборки и запуска бинарника. Требуется python. Если вы не используете редактор **VSCode** то можете удалить. |
  | build/ | Папка в которой находится конфигурация сборки и вывод сборки. |
  | data/ | Папка в которой должны находиться ваши данные. Вы можете её переименовать или вообще изменить (не забудьте указать изменения в конфиге сборки!). |
  | src/ | Это главная папка проекта. В ней хранятся все скрипты и коды. |
  | build.bat | Точка для запуска сборки проекта. Запускается в системе **Windows**. |
  | build.sh | Точка для запуска сборки проекта. Запускается в системе **MacOS** и **Linux**. |
  | run.bat | Точка для запуска скомпилированного проекта. Запускается в системе **Windows**. |
  | run.sh | Точка для запуска скомпилированного проекта. Запускается в системе **MacOS** и **Linux**. |
  | ... | _Вероятно могут быть и другие файлы, но основные из них выше_ |

#### 2. Папка сборки
Если с папками ```src/```, ```data/```, файлами сборки и запуска всё понятно, то что за папка **build/**?

Содержимое папки сборки может быть такой:</br>
- build/</br>
  | File/Folder | Description |
  | --- | --- |
  | out/ | Появится после запуска первой сборки. В ней хранится готовая бинарная программа. |
  | tmp/ | Появится после запуска первой сборки. В ней хранятся объектные файлы исходников и прочее необходимое для компиляции. Она не удаляется для ускорения сборки. |
  | tools/ | Это важная папка системы сборки. В ней хранятся скрипты для сборки и запуска, и кэш сборки для её ускорения. |
  | config.json | Это конфигурационный файл системы сборки. В нём вы можете всё настроить под себя. |

#### 3. Конфигурация сборки
Она может выглядеть примерно так:
```json
{
    "program-name": "C Program Framework",
    "program-icon": "data/icons/icon.ico",
    "compiler":     "gcc",
    "std":          "c99",
    "strip":        true,
    "includes":     ["src/include/"],
    "optimization": "-O3",
    "console-disabled": false,
    "warnings": ["-Wall"],
    "cflags": []
}
```

! Вы должны разбираться в том как компилировать программы на C/C++ чтобы что-нибудь тут изменить !

Но кроме того, можно изменить вот что:
| Key | Description |
| --- | --- |
| "program-name" | В кавычках указывается название бинарного файла. |
| "program-icon" | В кавычках указывается путь до иконки. |
| "compiler" | В кавычках укажите ваш компилятор, или путь до него. |
| "strip" | ```true```/```false``` если хотите убрать отладочную информацию и уменьшить размер бинарника. |
| "includes" | В кавычках через запятую укажите пути до папок в которых лежат ваши заголовочные файлы. |
| "console-disabled" | ```true```/```false``` если хотите отключить открывание консоли. |
| "cflags" | Список дополнительных флагов компиляции которые надо указывать в кавычках через запятую: ["-f1", "-f2", и тд]. |

**Особенности конфигурационного файла:**</br>
Такие параметры как: ```"program-icon"```, ```"console-disabled"```, работают только в системе **Windows**!

#

### Принцип работы системы сборки
Система сборки написана на питоне. При её запуске, происходит следующее:
1. Чтение файла ```build/config.json```
2. Проверка файлов. Включает в себя:
    - Получение нового ```build/tools/metadata.json```. Метаданные хранят список файлов исходников и время их изменения в секундах.
    - Получение разницы из новых метаданных по сравнению со старым. А именно: Изменённые файлы, добавленные файлы, удаленные файлы.
    - Если папки ```tmp``` для хранения файлов для линков нет в ```build/``` то она создаётся.
    - Если папка ```build/out/``` есть, то удаляем. Потом просто создаём эту папку даже если её не было.
    - Удаляются объектные файлы удаленных исходников из ```build/tmp/``` в случае если они там есть.
    - Удаляются лишние объектные файлы, которых не должно быть (например: старые объектные файлы которые больше не нужны или другие лишние объекты).
    - Проводится проверка на отсутствующие объектные файлы, чтобы добавить их исходник в список для компиляции.
    - Возвращается список путей исходников для компиляции.
3. Подготавливаются флаги для компиляции и линковки. Превращаем их в почти готовые команды.
4. Старт компиляции:
    - Из папки ```build/tmp/``` удаляются все файлы с расширением ```.ico```
    - Создаём ```.o``` файл иконки если это Windows система используя ```icon.rc``` и ```windres```
    - Иначе если это не ```Windows``` система, ИЛИ если путь иконки указан как ```null``` то удаляем объект иконки и ```icon.rc``` при наличии.
    - Компилируем все необходимые исходники. Используем подготовленную команду компиляции. Компилируем исходник через ```-c``` в папку ```build/tmp/```
    - Линкуем все объектные файлы в один исполняемый файл. Используем подготовленную команду линковки. Линкуем в папку ```build/out/```

**Что делает:**
Компилирует только изменённые, новые и те исходники, у которых нет объектного файла.</br>
Она сама удаляет те объектные файлы, исходник которых удалён. Также удаляет лишние объекты, которых не должно быть (очистка от мусора). Она отслеживает файлы исходников и их время изменения.</br>

**Минусы:**</br>
Компиляция последовательная, что медленнее чем параллельная.</br>
Таккже нет кэширования компиляции.</br>

В будущем планируется добавить параллельную компиляцию для ускорения работы, а также по возможности кэширование компиляции. Тогда эта система сборки будет прям очень хорошей, и будет подходить для больших проектов.

#

### Связь со мной:
#### [Telegram](https://t.me/mr_lukov)
