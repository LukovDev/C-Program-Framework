# C Program Framework
### Незамышлённый фреймворк для разработки своих проектов на языке программирования C/C++
### Описание:
#### Представляет собой гибкую и простую структуру файлов и папок. А так же, этот фреймворк имеет свою систему сборки проекта.
#### Подходит для минимального старта разработки проектов на C/C++, без сложных других систем сборок (включая **CMake**, **Make**, **Ninja** и пр., но при желании можно вручную модифицировать). Для работы вам понадобится всего лишь компилятор C и C++ (gcc + g++/clang) и python (от 3.x до 3.11.8 проверенно!). Систему сборки можно удалить, модифицировать под себя, или вообще заменить на другую по желанию.

#

### Краткая инструкция по использованию:

##### **<| В ЭТОЙ ИНСТРУКЦИИ НЕ БУДЕТ ПРИМЕРОВ НАГЛЯДНО. ВЫ ДОЛЖНЫ САМИ ПОНИМАТЬ ЧТО ДЕЛАЕТЕ, ЗАЧЕМ И ПОЧЕМУ |>**

#### 1. Хорошо, а как скачать этот ваш фреймворк?

Для скачивания фреймворка используйте прямую ссылку на скачивание [этого репозитория](https://github.com/LukovDev/C-Program-Framework/archive/refs/heads/master.zip)</br>
Если вы достаточно опытны, вы можете сами модифицировать фреймворк. Например: удалять прочие файлы, по типу ```README.md```, ```LICENSE.txt``` и пр., или модифицировать систему сборки.

На данный момент, официально фреймворк работает на (проверено):</br>
- **Windows** [✓]
- **MacOS** [✓]
- **Linux** [✓]

#### 2. Хорошо, вот я скачал, и что дальше?

А дальше, разархивируйте архив и переместите из полученной папки содержимое (все файлы и папки) в другую папку, или переименуйте её так как вам удобнее. Обычно, это название вашего проекта.

#### 3. А потом что?

Теперь, откройте эту папку как папку проекта в редакторе кода.
Все исходные скрипты и коды должны находиться в папке ```src```! (хотя система сборки жёстко не запрещает размещать где угодно).

#

### Структура фреймворка

#### 1. Файлы и папки
Перед вами будет примерно такое содержимое:</br>
- MyProject/</br>
  | File/Folder | Description |
  | --- | --- |
  | .vscode/ | Хранит конфигурацию для запуска сборки и запуска бинарника. Требуется python. Если вы не используете редактор **VSCode** то можете удалить. |
  | build/ | Папка в которой находится конфигурация сборки и вывод сборки. |
  | data/ | Папка в которой должны находиться ваши данные. |
  | src/ | Это главная папка проекта. В ней хранятся все скрипты и коды. |
  | build.bat | Точка для запуска сборки проекта. Запускается в системе **Windows**. |
  | build.sh | Точка для запуска сборки проекта. Запускается в системе **MacOS** и **Linux**. |
  | run.bat | Точка для запуска скомпилированного проекта. Запускается в системе **Windows**. |
  | run.sh | Точка для запуска скомпилированного проекта. Запускается в системе **MacOS** и **Linux**. |
  | ... | _Вероятно могут быть и другие файлы, но основные из них выше_ |

#### 2. Папка сборки
Если с папками ```src/```, ```data/```, файлами сборки и запуска всё понятно, то что за папка **build/**?

Содержимое папки сборки:</br>
- build/</br>
  | File/Folder | Description |
  | --- | --- |
  | bin/ | Появится после запуска первой сборки. В ней хранятся все готовые бинарные файлы после сборки и динамические библиотеки для запуска программы. |
  | obj/ | Появится после запуска первой сборки. В ней хранятся объектные файлы исходников и прочее необходимое для компиляции. Она не удаляется для ускорения сборки. |
  | tools/ | Это важная папка системы сборки. В ней хранятся скрипты для сборки и запуска, и кэш сборки для её ускорения. Не трогайте эту папку и содержимое! |
  | config.json | Это конфигурационный файл системы сборки. В нём вы можете всё настроить под себя. |

#

### Система сборки

Относительно небольшая, но полная документация по системе сборки фреймворка.

#### 1. Конфигурация сборки
Это ```.json``` файл в котором прописаны параметры системы сборки.

Конфигурация выглядит примерно так:
```json
{
    "program-name":  "C Program Framework",
    "program-icon":  "data/icons/icon.ico",
    "source-dirs":   ["src/"],
    "build-dir":     "build/",
    "bin-dir-name":  "bin",
    "obj-dir-name":  "obj",
    "libs-output":   "",
    "build-logging": true,
    "strip":         true,
    "console-disabled": false,
    "defines":       [],
    "includes":      [],
    "libraries":     [],
    "libnames":      [],
    "optimization":  "-O2",
    "std-c":         "c17",
    "std-cpp":       "c++17",
    "compiler-c":    "gcc",
    "compiler-cpp":  "g++",
    "linker":        "g++",
    "warnings":      ["-Wall"],
    "compile-flags": [],
    "linker-flags":  []
}
```

Что за что отвечает:
| Key | Description |
| --- | --- |
| "program-name" | Название итогового бинарного файла в папке бинара. |
| "program-icon" | Иконка для программы. Работает только на системе **Windows**. Путь относителен от каталога проекта. |
| "source-dirs" | Массив относительных путей от каталога проекта до каталогов в которых надо искать исходники (**.c**/**.cpp** файлы). |
| "build-dir" | Название папки сборки. Вы можете переименовать папку ```build``` во что нибудь другое, и указать это название здесь, чтобы всё корректно работало. Также обновите это название в файлах ```build.bat/.sh``` и ```run.bat/.sh``` |
| "bin-dir-name" | Название папки в которую будут копироваться динамические библиотеки и размещаться главный бинарный файл программы. (Лучше не менять). |
| "obj-dir-name" | Название папки в которой будут размещаться объектные файлы исходников и другие файлы для линковки. (Лучше не менять). |
| "libs-output"  | Путь до папки в которую будут скопированы все динамические библиотеки. Путь относительно папки бинара сборки ```build/bin/```. Пример значения: ```"libs/"```, Результат: библиотеки копируются в ```build/bin/libs/``` |
| "build-logging" | Включить или выключить вывод подробной информации при сборке и запуске. |
| "strip" | Сжать ли бинарный файл программы (убрав отладочную информацию и прочие поля в файле). |
| "console-disabled" | Отключить консоль или нет. Работает только на системе **Windows**. |
| "defines" | Массив строк с определениями, которые добавляются на этапе компиляции файлов. Например: ```["MY_DEFINE=12345", "ENABLE_MODE", ...]``` и так далее. |
| "includes" | Массив относительных путей от каталога проекта до каталогов с заголовочными файлами, в которых надо искать заголовки. Например: ```["src/includes/", "src/app/core/", ...]``` и так далее. |
| "libraries" | Массив относительных путей от каталога проекта до каталогов библиотек. Например: ```["src/lib/", ...]``` и так далее. |
| "libnames" | Массив названий библиотек. Например: ```["SDL3", ...]``` и так далее. |
| "optimization" | Уровень оптимизации. Обычно от 0 до 3. Весь диапазон: ```-O0```, ```-O1```, ```-O2```, ```-O3```. Узнать какой уровень что делает можно в интернете. |
| "std-c" | Версия стандарта для языка **C**. |
| "std-cpp" | Версия стандарта для языка **C++**. |
| "compiler-c" | Компилятор для языка **C**. Можно указать либо просто команду доступную из терминала (например просто ```gcc```), либо путь до него (например ```/bin/gcc``` или  ```C:/Program Files/MinGW64/bin/gcc``` и тому подобное). |
| "compiler-cpp" | Компилятор для языка **C++**. Можно указать либо просто команду доступную из терминала (например просто ```g++```), либо путь до него (например ```/bin/g++``` или  ```C:/Program Files/MinGW64/bin/g++``` и тому подобное). |
| "linker" | Линкер для объединения объектных файлов в один исполняемый файл. Можно указать либо просто команду доступную из терминала (например просто ```g++```), либо путь до него (например ```/bin/g++``` или  ```C:/Program Files/MinGW64/bin/g++``` и тому подобное). |
| "warnings" | Массив строк флагов отвечающие за предупреждения во время компиляции. |
| "compile-flags" | Массив дополнительных флагов компиляции. |
| "linker-flags" | Массив дополнительных флагов линковки. |

**Особенности конфигурационного файла:**</br>
Такие параметры как: ```"program-icon"```, ```"console-disabled"```, работают только в системе **Windows**!

#### 2. Принцип работы
<img width="578" height="279" alt="Screenshot_3" src="https://github.com/user-attachments/assets/b59d1562-a67b-4ba9-b3ec-de533206536a" />

Система сборки написана на питоне. При её запуске, происходит следующее:
1. Чтение файлов ```build/config.json``` и ```build/tools/metadata.json```
2. Переход из директории ```build/tools/``` в корневую директорию проекта.
3. Проверка флагов на очистку сборки ```-c``` или ```-clear```. В случае присутствия, удаление папки ```build/obj/``` и её создание.
4. Поиск всех файлов исходников (**.c**/**.cpp**) по всем указанным каталогам.
5. Поиск всех динамических библиотек для копирования в каталог бинара.
6. Получение нового **metadata** из найденных файлов (для сравнения с сохранённым ```build/tools/metadata.json```).
7. Проверка каталогов сборки (такие как ```obj``` и ```bin```) и создание в случае отсутствия.
8. Обработка файлов:
   - Получение данных из старой и новой метаданных.
   - Находим измененные, новые и удаленные файлы.
   - Удаляем все объектные файлы, если прошлая сборка была сделана на другой системе.
   - Удаление объектных файлов по списку удалённых исходников.
   - Создание списка всех целевых **.o** файлов из актуальных **.c**/**.cpp** файлов.
   - Удаление **.o** файлов, исходников которых больше нет.
   - Проверка на отсутствующие **.o** файлы (если есть какой-то исходник у которого нет **.o** файла, добавляем в массив для компиляции).
9. Генерируем флаги сборки (флаги компиляции и линковки).
10. Собираем программу:
    - Пересоздаём иконку программы для системы **Windows** при необходимости.
    - Компиляция исходников. Запуск отдельного потока для каждого исходника. В каждом потоке происходит следующее:
      - Определение типа компилятора (**compiler-c** или **compiler-cpp**) и стандарта для него (**std-c** или **std-cpp**).
      - Генерация финального массива флагов для компиляции.
      - Компиляция исходника.
    - Ожидание завершения всех отдельных потоков компиляции.
    - Линкуем все объектные файлы в один исполняемый файл.
11. Копируем необходимые библиотеки в папку бинара:
    - Проверяем путь до папки в которой должны быть библиотеки, и создаём недостающие папки (относительно папки бинара).
    - Копируем в созданный путь все необходимые библиотеки.
12. Сохраняем новые метаданные в случае удачной сборки.

**Пометки:**
- В случае фатальной ошибки (при ошибки компиляции, линковки, или чего-либо ещё), ошибка выводится в терминал минуя отключение вывода информации и жёстко останавливает систему сборки через ```os._exit(1)``` чтобы прервать компиляцию других файлов и этапов сборки.
- Скрипт системы сборки хорошо документирован и разделён по этапам и функциям. Так что его можно изучить самому и более точно разобрать как он работает.

**Что делает (в двух словах):**
- Компилирует только изменённые, новые, и те исходники у которых нет объектного файла.
- Удаляет те объектные файлы, исходник которых удалён. Также удаляет лишние объекты, которых не должно быть (очистка от мусора). Она отслеживает файлы исходников и их время изменения.
- Ищет в указанных папках библиотек, определенные библиотеки чьи названия схожи с теми, что указаны в списке названий библиотек, и копирует их в папку ```build/bin/``` с возможностью указать путь в этой папке где должны находиться библиотеки (например: ```build/bin/libs/```, в конфиге просто указывается ```libs/```).
- Компилирует одновременно все файлы в отдельных потоках и ждёт завершение компиляции всех файлов чтобы начать их линковку.
- Отслеживает результаты выполнения команд. В случае ошибки происходит остановка сборки.
- Автоматически определяет какие компиляторы и стандарты для них использовать при компиляции определённых файлов, исходя из их расширения.
- Гибко написанный скрипт работает на всех трёх системах одинаково (NT/Unix). Только для PC!

#

### Для запуска файлов ```build.sh``` и ```run.sh``` на **MacOS**
Откройте терминал по адресу папки проекта, где находятся эти файлы, и выполните следующее:</br>
```chmod +x build.sh run.sh```</br>
Это даст разрешение файлам выполняться.

#

### Связь со мной:
#### [Telegram](https://t.me/mr_lukov)
